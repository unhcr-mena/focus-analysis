---
output: 
  word_document: 
    fig_caption: yes
    fig_width: 11
    toc: yes
---
```{r , echo=FALSE, warning=FALSE, message=FALSE, cache=FALSE}

ctrname <- "Jordan"
yearreport <- "2018"

```



```{r include=FALSE, cache=FALSE}

library(ggplot2)
library(ggthemes)
library(rmarkdown)
library(xtable)
library(knitr)
library(pander)  ## library to format regression output in Rmd
library(readxl)

```


```{r , echo=FALSE, warning=FALSE, message=FALSE, cache=FALSE}
#setwd("D:/R-project/focus-analysis") 

##  Loading the 3 dataset - Impact, performance, budget
focus.impact <- read.csv("D:/R-project/focus-analysis/data/impact.csv")

focus.budget <- read.csv("D:/R-project/focus-analysis/data/budget.csv")

focus.narrative <- read.csv("D:/R-project/focus-analysis/data/narrative.csv")



framework <- read_excel("D:/R-project/focus-analysis/config/UNHCR-Result-Based-Management.xlsx", sheet = 1) 
#names(framework)
framework<- framework[ !(is.na(framework$Indicator)) ,  ]
framework<- framework[ !(framework$dup2 %in% c('dup')) ,  ]
 # names(framework)

## load all R packages for the analysis
source("D:/R-project/focus-analysis/code/0-package.R")

```


```{r , echo=FALSE, warning=FALSE, message=FALSE, cache=FALSE}

library(reshape2)
## Subset for the country
focus1.impact <-focus.impact[focus.impact$operationName == ctrname, ]
source("D:/R-project/focus-analysis/code/timeindic.R")

focus1.budget <-focus.budget[focus.budget$operationName == ctrname, ]

focus1.narrative <-focus.narrative[focus.narrative$operationName == ctrname, ]

## Number of ppggoal

focus1.impact$ppggoalsit <- paste(focus1.impact$Population.Group, focus1.impact$Goal, focus1.impact$SituationName, sep=" - ")
focus1.narrative$ppggoal <- paste(focus1.narrative$Population.Group, focus1.narrative$Goal, sep=" - ")

ppg.ctr <- as.character(unique(focus1.impact[focus1.impact$planningPeriod==2018, c("Population.Group")]))

ppggoalsit1 <- as.character(unique(focus1.impact[focus1.impact$planningPeriod==2018, c("ppggoalsit")]))
ppggoalsit <- length(unique(focus1.impact[focus1.impact$planningPeriod==2018, c("ppggoalsit")]))

## Extracting last refresh date

#names(focus1.impact)

lastRefreshedate <- as.character(unique(focus1.impact[focus1.impact$planningPeriod==2018, c("lastRefreshed")]))

Objectives.2018 <- length(unique(focus1.impact[focus1.impact$planningPeriod==2018, c("Objective")]))
Objectives.2017 <- length(unique(focus1.impact[focus1.impact$planningPeriod==2017, c("Objective")]))

impindic.2018 <- length(unique(focus1.impact[focus1.impact$planningPeriod==2018, c("rid")]))
impindic.2017 <- length(unique(focus1.impact[focus1.impact$planningPeriod==2017, c("rid")]))

ol.budget.2018 <- format(sum(focus1.budget[focus1.budget$scenario=="Operating Level" & focus1.impact$planningPeriod==2018, c("amount")]),
                        digits=2, decimal.mark=".",  big.mark=",", scientific=FALSE)

aol.budget.2018 <- format( sum(focus1.budget[focus1.budget$scenario=="Above Operating Level" & focus1.impact$planningPeriod==2018, c("amount")]),
                         digits=2, decimal.mark=".",  big.mark=",", scientific=FALSE)

ol.budget.2017 <- format( sum(focus1.budget[focus1.budget$scenario=="Operating Level" & focus1.impact$planningPeriod==2018,c("amount")])
                         - sum(focus1.budget[focus1.budget$scenario=="Operating Level" & focus1.impact$planningPeriod==2017, c("amount")]),
                          digits=2, decimal.mark=".",  big.mark=",", scientific=FALSE)

aol.budget.2017 <- format(sum(focus1.budget[focus1.budget$scenario=="Above Operating Level" & focus1.impact$planningPeriod==2018,c("amount")])
                         - sum(focus1.budget[focus1.budget$scenario=="Above Operating Level" & focus1.impact$planningPeriod==2017, c("amount")]),
                          digits=2, decimal.mark=".",  big.mark=",", scientific=FALSE)


```



---
title: "Annual Review of `r ctrname` Country Operation Plan- `r yearreport`"
author: "MENA office of the Director"
date: "`r Sys.Date()`"
---

*** 

# Introduction 

This reports provides an high level review of  `r ctrname` country operation programme as edited on the `r lastRefreshedate`.

This plan present an "operating level" budget of  `r ol.budget.2018` USD (difference of `r ol.budget.2017` USD with 2017) and an "above operating level" budget of `r aol.budget.2018` USD (difference of `r aol.budget.2017` USD with 2017)


Globally the budget evolution per area of expertise is:


```{r , echo=FALSE, warning=FALSE, message=FALSE, cache=FALSE, fig.width=10, fig.height=14}
 


ggplot(focus1.budget[focus1.budget$planningPeriod %in% c("2016","2017","2018"), ], aes(x=  planningPeriod , fill=scenario )) + 
            geom_bar(aes(y = amount), stat="identity") +
            facet_wrap(~ subtype.obj, ncol=1) +
           # ggtitle(paste0("Output: ", indicplot)) +
            ggtitle("Budget per scenario & year (in USD for Operating level only",  
                  subtitle = "Breakdown per functional area ")+
            coord_flip()+
            xlab("") + ylab("") +
            scale_y_continuous(labels=format_si())+
            theme_economist_white()+
            theme(legend.key=element_blank(),
                  plot.title=element_text(face="bold", size=12),
                  axis.text = element_text(size = 7, face="plain"),
                  #legend.title=element_blank(),
                  legend.box="horizontal")



```


The plan includes: 

 *  `r ppggoalsit` Population Planning Group(s) associated with Goal & situation,

```{r , echo=FALSE, warning=FALSE, message=FALSE, cache=FALSE}
 
kable(ppggoalsit1)

```



 *  `r Objectives.2018` Objectives (`r Objectives.2017`% change compared with 2017), 

 *  `r impindic.2018` Impact indicators (`r impindic.2017` % change compared 2017)

The report looks at the	per objective within each sector:

 1.	Budget evolution 2016 to 2018 at objective level – stacked by scenario. 
 
 2.	Impact indicators From 2016 year end till 2018 baseline – Notify if GSP or not in the title of the chart.
 
 3.	Comparison of Narrative 2016– “Results and Impact - Results and Impact”, 2017& 2018 “Problem/Objective - Prioritized Response” 
 
 4. Based, on the elements above, feedback if any from the experts within the office of the director

*** 
 
# Refugee Registration
*** 
 
# Refugee Status Determination (RSD)
*** 
# Resettlement
*** 
# Child Protection
*** 
# Sexual and other forms of gender-based violence (SGBV)
*** 
# Education
*** 
# Legal issues
*** 
# Mixed Migration
*** 
# Statelessness
*** 
# Community Services
*** 
# Community Based Protection
*** 
# Communication
*** 
# Protection Coordination
*** 
# Non Food Item (NFI) & Cash Based Intervention
*** 
# Health
*** 
# Food Security & Nutrition
*** 
# Shelter
*** 
# WASH
*** 
# Supply
*** 
# Camp Coordination and Camp Management (CCCM)
*** 
# Energy
*** 
# Environment
*** 
# Management
*** 
# External Relation
*** 
# Response Coordination




