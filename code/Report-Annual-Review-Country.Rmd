---
output: 
  word_document: 
    fig_caption: yes
    fig_width: 11
    toc: yes
    toc_depth: 2
---

```{r , echo=FALSE, warning=FALSE, message=FALSE, cache=FALSE}

#ctrname <- "Jordan"
yearreport <- "2018"


```



```{r include=FALSE, cache=FALSE}

library(ggplot2)
library(ggthemes)
library(rmarkdown)
library(xtable)
library(knitr)
library(pander)  ## library to format regression output in Rmd
library(readxl)

```


```{r , echo=FALSE, warning=FALSE, message=FALSE, cache=FALSE}
#setwd("C:/R-project/focus-analysis1") 

## load all R packages for the analysis
source("C:/R-project/focus-analysis1/code/0-package.R")

##  Loading the 3 dataset - Impact, performance, budget
focus.impact <- read.csv("C:/R-project/focus-analysis1/data/impact.csv")
## Subset for the country
focus1.impact <-focus.impact[focus.impact$operationName == ctrname, ]
source("C:/R-project/focus-analysis1/code/timeindic.R")

focus.budget <- read.csv("C:/R-project/focus-analysis1/data/budget.csv")
focus1.budget <-focus.budget[focus.budget$operationName == ctrname, ]

framework <- read_excel("C:/R-project/focus-analysis1/config/UNHCR-Result-Based-Management.xlsx", sheet = 1) 
#names(framework)
framework<- framework[ !(is.na(framework$Indicator)) ,  ]
framework<- framework[ !(framework$dup2 %in% c('dup')) ,  ]
 # names(framework)

focus.narrative <- read.csv("C:/R-project/focus-analysis1/data/narrative.csv")
focus1.narrative <-focus.narrative[focus.narrative$operationName == ctrname, ]
focus1.narrative$ppggoal <- paste(focus1.narrative$Population.Group, focus1.narrative$goal, sep=" - ")

## Number of ppggoal
focus1.impact$ppggoalsit <- paste(focus1.impact$Population.Group, focus1.impact$Goal, focus1.impact$SituationName, sep=" - ")
ppg.ctr <- as.character(unique(focus1.impact[focus1.impact$planningPeriod==2018, c("Population.Group")]))

ppggoalsit1 <- as.character(unique(focus1.impact[focus1.impact$planningPeriod==2018, c("ppggoalsit")]))
ppggoalsit <- length(unique(focus1.impact[focus1.impact$planningPeriod==2018, c("ppggoalsit")]))

## Extracting last refresh date

#names(focus1.impact)

lastRefreshedate <- as.character(unique(focus1.impact[focus1.impact$planningPeriod==2018, c("lastRefreshed")]))

Objectives.2018 <- length(unique(focus1.impact[focus1.impact$planningPeriod==2018, c("Objective")]))
Objectives.2017 <- length(unique(focus1.impact[focus1.impact$planningPeriod==2017, c("Objective")]))

impindic.2018 <- length(unique(focus1.impact[focus1.impact$planningPeriod==2018, c("rid")]))
impindic.2017 <- length(unique(focus1.impact[focus1.impact$planningPeriod==2017, c("rid")]))

ol.budget.2018 <- format(sum(focus1.budget[focus1.budget$scenario=="Operating Level" & focus1.impact$planningPeriod==2018, c("amount")]),
                        digits=2, decimal.mark=".",  big.mark=",", scientific=FALSE)

aol.budget.2018 <- format( sum(focus1.budget[focus1.budget$scenario=="Above Operating Level" & focus1.impact$planningPeriod==2018, c("amount")]),
                         digits=2, decimal.mark=".",  big.mark=",", scientific=FALSE)

ol.budget.2017 <- format( sum(focus1.budget[focus1.budget$scenario=="Operating Level" & focus1.impact$planningPeriod==2018,c("amount")])
                         - sum(focus1.budget[focus1.budget$scenario=="Operating Level" & focus1.impact$planningPeriod==2017, c("amount")]),
                          digits=2, decimal.mark=".",  big.mark=",", scientific=FALSE)

aol.budget.2017 <- format(sum(focus1.budget[focus1.budget$scenario=="Above Operating Level" & focus1.impact$planningPeriod==2018,c("amount")])
                         - sum(focus1.budget[focus1.budget$scenario=="Above Operating Level" & focus1.impact$planningPeriod==2017, c("amount")]),
                          digits=2, decimal.mark=".",  big.mark=",", scientific=FALSE)

```



---
title: "Annual Review of `r ctrname` Country Operation Plan- `r yearreport`"
author: "MENA office of the Director"
date: "`r Sys.Date()`"
---

*** 

# Introduction 

This reports provides an high level review of  `r ctrname` country operation programme as updated in Focus on the `r lastRefreshedate`.

The plan includes: 

 *  __`r ppggoalsit`__ Population Planning Group(s) associated with Goal & situation,

 *  __`r Objectives.2018`__ Objectives (`r Objectives.2017`% change compared with 2017), 

 *  __`r impindic.2018`__ Impact indicators (`r impindic.2017` % change compared 2017)

The report is extracting information from Focus in order to review selected objectives within each sector/functional areas:

 1.	Comparison of Narrative 2016– “Results and Impact - Results and Impact”, 2017& 2018 “Problem/Objective - Prioritized Response” 
 
 2.	Budget evolution from 2016 to 2018 at objective level – stacked by scenario.
 
 3.	Impact indicators from 2016 year end till 2018 baseline – Notify if GSP or not in the title of the chart.
 
 4. Based, on the elements above, feedback if any from the experts within the office of the director

This plan present an "operating level" budget of  __`r ol.budget.2018`USD__  (difference of `r ol.budget.2017` USD with 2017) and an "above operating level" budget of __`r aol.budget.2018` USD__ (difference of `r aol.budget.2017` USD with 2017)


Globally the budget evolution per area of expertise is:

```{r , echo=FALSE, warning=FALSE, message=FALSE, cache=FALSE, fig.width=10, fig.height=16}
 


ggplot(focus1.budget[focus1.budget$planningPeriod %in% c("2016","2017","2018"), ], aes(x=  planningPeriod , fill=scenario )) + 
            geom_bar(aes(y = amount), stat="identity") +
            facet_wrap(~ subtype.obj, ncol=1) +
           # ggtitle(paste0("Output: ", indicplot)) +
            ggtitle("Budget per scenario & year (in USD for Operating level only",  
                  subtitle = "Breakdown per functional area ")+
            coord_flip()+
            xlab("") + ylab("") +
            scale_y_continuous(labels=format_si())+
            theme_economist_white()+
            theme(legend.key=element_blank(),
                  plot.title=element_text(face="bold", size=12),
                  axis.text = element_text(size = 7, face="plain"),
                  #legend.title=element_blank(),
                  legend.box="horizontal")

```



*** 
 
# Refugee Registration



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "Registration"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```




*** 
 
# Refugee Status Determination (RSD)



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "RSD"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# Resettlement



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "Resettlement"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# Child Protection



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "ChildProtection"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# Sexual and other forms of gender-based violence (SGBV)



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "SGBV"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# Education



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "Education"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# Legal issues



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "Legal"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# Mixed Migration



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "Mixed migration"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# Statelessness



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "Statelessness"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# Community Services



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "Community Services"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# Community Based Protection



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "Community Based Protection"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# Communication



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "Communication"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# Protection Coordination



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "ProtCoordination"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# Non Food Item (NFI) & Cash Based Intervention



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "NFI-cash"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# Health



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "Health"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# Food Security & Nutrition



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "Food"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# Shelter



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "Shelter"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# WASH



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "WASH"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# Supply



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "Supply"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# Camp Coordination and Camp Management (CCCM)



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "CCCM"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# Energy



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "Energy"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# Environment



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "Environment"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# Management



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "Management"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# External Relations



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "ExtRel"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```



*** 
# Response Coordination



```{r , echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.width=10, fig.height=6}
this.subtype <- "Coordination"
source("C:/R-project/focus-analysis1/code/obj.review.R")
```







